(()=>{var e={n:t=>{var l=t&&t.__esModule?()=>t.default:()=>t;return e.d(l,{a:l}),l},d:(t,l)=>{for(var a in l)e.o(l,a)&&!e.o(t,a)&&Object.defineProperty(t,a,{enumerable:!0,get:l[a]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};(()=>{"use strict";const t=flarum.core.compat["admin/app"];var l=e.n(t);function a(e,t){return a=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},a(e,t)}const r=flarum.core.compat["common/Component"];var o=e.n(r);const s=flarum.core.compat["common/components/Button"];var n=e.n(s);const i=flarum.core.compat["common/components/LoadingIndicator"];var u=e.n(i);const d=flarum.core.compat["common/components/Select"];var p=e.n(d),c=function(e){function t(){return e.apply(this,arguments)||this}var l,r;r=e,(l=t).prototype=Object.create(r.prototype),l.prototype.constructor=l,a(l,r);var o=t.prototype;return o.oninit=function(t){e.prototype.oninit.call(this,t),this.loading=!0,this.files=[],this.groups=[],this.users=[],this.selectedUserId=null,this.selectedGroupId=null,this.selectedDuration="30d",this.uploadFileIsPublic=!1,this.uploadFileGroups=[],this.fileInputRef=null,this.hwidUserIdRef=null,this.loadData()},o.oncreate=function(t){e.prototype.oncreate.call(this,t),this.element=t.dom},o.loadData=function(){var e=this;Promise.all([app.store.all("groups"),app.request({method:"GET",url:app.forum.attribute("apiUrl")+"/fla-loader/files"})]).then(function(t){var l=t[0],a=t[1];e.groups=l,e.files=a.data||[],e.loading=!1,m.redraw()})},o.view=function(){var e=this;return this.loading?m(u(),null):m("div",{className:"FlaLoaderPage"},m("div",{className:"container"},m("h2",null,"Fla Loader Management"),m("div",{className:"FlaLoaderSection"},m("h3",null,"File Management"),m("div",{className:"Form"},m("div",{className:"Form-group"},m("label",null,"Upload File"),m("input",{type:"file",oncreate:function(t){e.fileInputRef=t.dom}})),m("div",{className:"Form-group"},m("label",null,m("input",{type:"checkbox",checked:this.uploadFileIsPublic,onchange:function(t){e.uploadFileIsPublic=t.target.checked}})," ","Make file public (visible in Download page)")),m("div",{className:"Form-group"},m("label",null,"Allowed Groups (hold Ctrl/Cmd to select multiple)"),m("select",{multiple:!0,className:"FormControl",style:"height: 120px;",onchange:function(t){e.uploadFileGroups=Array.from(t.target.selectedOptions).map(function(e){return parseInt(e.value)})}},this.groups.map(function(e){return m("option",{key:e.id(),value:e.id()},e.nameSingular())})),m("small",null,"Leave empty to allow all groups")),m(n(),{className:"Button Button--primary",onclick:function(){return e.uploadFile()}},"Upload File"),m("div",{className:"FileList"},m("h4",null,"Uploaded Files"),0===this.files.length?m("p",null,"No files uploaded yet."):m("table",{className:"Table"},m("thead",null,m("tr",null,m("th",null,"File Name"),m("th",null,"Public"),m("th",null,"Allowed Groups"),m("th",null,"Actions"))),m("tbody",null,this.files.map(function(t){return m("tr",{key:t.id},m("td",null,t.originalName),m("td",null,t.isPublic?"Yes":"No"),m("td",null,t.allowedGroups.length>0?t.allowedGroups.join(", "):"All"),m("td",null,m(n(),{className:"Button Button--danger",onclick:function(){return e.deleteFile(t.id)}},"Delete")))})))))),m("div",{className:"FlaLoaderSection"},m("h3",null,"Time-Limited Role Assignment"),m("div",{className:"Form"},m("div",{className:"Form-group"},m("label",null,"User ID"),m("input",{type:"number",className:"FormControl",value:this.selectedUserId||"",oninput:function(t){e.selectedUserId=t.target.value},placeholder:"Enter user ID"})),m("div",{className:"Form-group"},m("label",null,"Group"),m(p(),{value:this.selectedGroupId,options:this.groups.reduce(function(e,t){return e[t.id()]=t.nameSingular(),e},{}),onchange:function(t){e.selectedGroupId=t}})),m("div",{className:"Form-group"},m("label",null,"Duration"),m(p(),{value:this.selectedDuration,options:{"7d":"7 Days","30d":"30 Days","180d":"180 Days","1y":"1 Year",lifetime:"Lifetime"},onchange:function(t){e.selectedDuration=t}})),m(n(),{className:"Button Button--primary",onclick:function(){return e.assignRole()}},"Assign Role"))),m("div",{className:"FlaLoaderSection"},m("h3",null,"HWID Management"),m("div",{className:"Form"},m("div",{className:"Form-group"},m("label",null,"User ID"),m("input",{type:"number",className:"FormControl",oncreate:function(t){e.hwidUserIdRef=t.dom},placeholder:"Enter user ID to check or reset HWID"})),m("div",{style:"display: flex; gap: 10px;"},m(n(),{className:"Button Button--primary",onclick:function(){return e.checkHwid()}},"Check HWID Status"),m(n(),{className:"Button Button--warning",onclick:function(){return e.resetHwid()}},"Reset HWID")),m("div",{id:"hwidStatus",style:"margin-top: 15px;"})))))},o.uploadFile=function(){var e=this,t=this.fileInputRef&&this.fileInputRef.files[0];if(t){var l=new FormData;l.append("file",t),l.append("isPublic",this.uploadFileIsPublic),l.append("allowedGroups",JSON.stringify(this.uploadFileGroups)),app.request({method:"POST",url:app.forum.attribute("apiUrl")+"/fla-loader/files",body:l,serialize:function(e){return e}}).then(function(){app.alerts.show({type:"success"},"File uploaded successfully"),e.fileInputRef&&(e.fileInputRef.value=""),e.uploadFileIsPublic=!1,e.uploadFileGroups=[],e.loadData()}).catch(function(){app.alerts.show({type:"error"},"Failed to upload file")})}else app.alerts.show({type:"error"},"Please select a file to upload")},o.deleteFile=function(e){var t=this;confirm("Are you sure you want to delete this file?")&&app.request({method:"DELETE",url:app.forum.attribute("apiUrl")+"/fla-loader/files/"+e}).then(function(){app.alerts.show({type:"success"},"File deleted successfully"),t.loadData()}).catch(function(){app.alerts.show({type:"error"},"Failed to delete file")})},o.assignRole=function(){var e=this;this.selectedUserId&&this.selectedGroupId?app.request({method:"POST",url:app.forum.attribute("apiUrl")+"/fla-loader/roles",body:{userId:this.selectedUserId,groupId:this.selectedGroupId,duration:this.selectedDuration}}).then(function(){app.alerts.show({type:"success"},"Role assigned successfully"),e.selectedUserId=null,e.selectedGroupId=null,e.selectedDuration="30d",m.redraw()}).catch(function(){app.alerts.show({type:"error"},"Failed to assign role")}):app.alerts.show({type:"error"},"Please fill in all fields")},o.checkHwid=function(){var e=this,t=this.hwidUserIdRef?this.hwidUserIdRef.value:null;t?app.request({method:"GET",url:app.forum.attribute("apiUrl")+"/fla-loader/hwid/"+t}).then(function(t){var l=t.data,a=e.element&&e.element.querySelector("#hwidStatus");a&&(a.innerHTML='\n          <div class="Alert Alert--info">\n            <strong>User:</strong> '+l.username+"<br>\n            <strong>Has HWID:</strong> "+(l.hasHwid?"Yes":"No")+"<br>\n            "+(l.hasHwid?"<strong>HWID Preview:</strong> "+l.hwid+"<br>":"")+"\n            "+(l.registeredAt?"<strong>Registered At:</strong> "+l.registeredAt:"")+"\n          </div>\n        "),app.alerts.show({type:"success"},"HWID status retrieved")}).catch(function(e){app.alerts.show({type:"error"},"Failed to get HWID status")}):app.alerts.show({type:"error"},"Please enter a user ID")},o.resetHwid=function(){var e=this,t=this.hwidUserIdRef?this.hwidUserIdRef.value:null;t?confirm("Are you sure you want to reset this user's HWID? They will be able to login from a new device.")&&app.request({method:"POST",url:app.forum.attribute("apiUrl")+"/fla-loader/hwid/reset",body:{userId:t}}).then(function(t){var l=t.data;app.alerts.show({type:"success"},l.message);var a=e.element&&e.element.querySelector("#hwidStatus");a&&(a.innerHTML=""),e.hwidUserIdRef&&(e.hwidUserIdRef.value="")}).catch(function(){app.alerts.show({type:"error"},"Failed to reset HWID")}):app.alerts.show({type:"error"},"Please enter a user ID")},t}(o());l().initializers.add("undertaker/fla-loader",function(){l().extensionData.for("undertaker/fla-loader").registerSetting({setting:"fla-loader.public_file_id",type:"text",label:l().translator.trans("undertaker-fla-loader.admin.settings.public_file_id_label"),help:l().translator.trans("undertaker-fla-loader.admin.settings.public_file_id_help")}).registerPermission({icon:"fas fa-download",label:l().translator.trans("undertaker-fla-loader.admin.permissions.download_files"),permission:"flaLoader.downloadFiles"},"view").registerPermission({icon:"fas fa-upload",label:l().translator.trans("undertaker-fla-loader.admin.permissions.manage_files"),permission:"flaLoader.manageFiles"},"moderate").registerPage({component:c,path:"/fla-loader"})})})(),module.exports={}})();
//# sourceMappingURL=admin.js.map